function whenDOMReady(){window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.expand=800,lazySizes.init(),hljs.highlightAll(),new ImageViewer}(()=>{const e={set:(e,t,n)=>{if(!n)return;const o=Date.now()+864e5*n;localStorage.setItem(e,JSON.stringify({value:t,expiry:o}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:n,expiry:o}=JSON.parse(t);if(!(Date.now()>o))return n;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((n,o)=>{const i=document.createElement("script");i.src=e,i.async=!0,Object.entries(t).forEach(([e,t])=>i.setAttribute(e,t)),i.onload=i.onreadystatechange=(()=>{i.readyState&&!/loaded|complete/.test(i.readyState)||n()}),i.onerror=o,document.head.appendChild(i)}),getCSS:(e,t)=>new Promise((n,o)=>{const i=document.createElement("link");i.rel="stylesheet",i.href=e,t&&(i.id=t),i.onload=i.onreadystatechange=(()=>{i.readyState&&!/loaded|complete/.test(i.readyState)||n()}),i.onerror=o,document.head.appendChild(i)}),addGlobalFn:(e,t,n=!1,o=window)=>{if(e.startsWith("pjax"))return;const i=o.globalFn||{};i[e]=i[e]||{},i[e][n||Object.keys(i[e]).length]=t,o.globalFn=i}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},n=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=t,btf.activateLightMode=n;e.get("theme");t();const o=e.get("aside-status");void 0!==o&&document.documentElement.classList.toggle("hide-aside","hide"===o);const i=()=>{/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")};i();const a={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1};var s={title:"打包地",isHighlightShrink:!1,isToc:!1,pageType:"home"};const r={debounce:(e,t=0,n=!1)=>{let o;return(...i)=>{const a=()=>{o=null,n||e(...i)},s=n&&!o;clearTimeout(o),o=setTimeout(a,t),s&&e(...i)}},throttle:function(e,t,n={}){let o,i,a,s=0;const r=()=>{s=!1===n.leading?0:(new Date).getTime(),o=null,e.apply(i,a),o||(i=a=null)},l=(...l)=>{const c=(new Date).getTime();s||!1!==n.leading||(s=c);const d=t-(c-s);i=this,a=l,d<=0||d>t?(o&&(clearTimeout(o),o=null),s=c,e.apply(i,a),o||(i=a=null)):o||!1===n.trailing||(o=setTimeout(r,d))};return l},overflowPaddingR:{add:()=>{const e=window.innerWidth-document.body.clientWidth;if(e>0){document.body.style.paddingRight=`${e}px`,document.body.style.overflow="hidden";const t=document.querySelector("#page-header.nav-fixed #menus");t&&(t.style.paddingRight=`${e}px`)}},remove:()=>{document.body.style.paddingRight="",document.body.style.overflow="";const e=document.querySelector("#page-header.nav-fixed #menus");e&&(e.style.paddingRight="")}},snackbarShow:(e,t=!1,n=2e3)=>{const{position:o,bgLight:i,bgDark:s}=a.Snackbar,r="light"===document.documentElement.getAttribute("data-theme")?i:s;Snackbar.show({text:e,backgroundColor:r,showAction:t,duration:n,pos:o,customClass:"snackbar-css"})},diffDate:(e,t=!1)=>{const n=new Date,o=new Date(e),i=n-o,s=i/1e3,r=s/60,l=r/60,c=l/24,d=c/30,{dateSuffix:m}=a;return t?d>12?o.toISOString().slice(0,10):d>=1?`${Math.floor(d)} ${m.month}`:c>=1?`${Math.floor(c)} ${m.day}`:l>=1?`${Math.floor(l)} ${m.hour}`:r>=1?`${Math.floor(r)} ${m.min}`:m.just:Math.floor(c)},loadComment:(e,t)=>{if("IntersectionObserver"in window){const n=new IntersectionObserver(e=>{e[0].isIntersecting&&(t(),n.disconnect())},{threshold:[0]});n.observe(e)}else t()},scrollToDest:(e,t=500)=>{const n=window.scrollY,o=document.getElementById("page-header").classList.contains("fixed");if((n>e||o)&&(e-=70),"scrollBehavior"in document.documentElement.style)return void window.scrollTo({top:e,behavior:"smooth"});const i=performance.now(),a=o=>{const s=o-i,r=Math.min(s/t,1);window.scrollTo(0,n+(e-n)*r),r<1&&requestAnimationFrame(a)};requestAnimationFrame(a)},animateIn:(e,t)=>{e.style.display="block",e.style.animation=t},animateOut:(e,t)=>{const n=()=>{e.style.display="",e.style.animation="",e.removeEventListener("animationend",n)};e.addEventListener("animationend",n),e.style.animation=t},wrap:(e,t,n)=>{const o=document.createElement(t);for(const[e,t]of Object.entries(n))o.setAttribute(e,t);e.parentNode.insertBefore(o,e),o.appendChild(e)},isHidden:e=>0===e.offsetHeight&&0===e.offsetWidth,getEleTop:e=>{let t=e.offsetTop,n=e.offsetParent;for(;null!==n;)t+=n.offsetTop,n=n.offsetParent;return t},loadLightbox:e=>{const t=a.lightbox;"medium_zoom"===t&&mediumZoom(e,{background:"var(--zoom-bg)"}),"fancybox"===t&&(Array.from(e).forEach(e=>{if("A"!==e.parentNode.tagName){const t=e.dataset.lazySrc||e.src,n=e.title||e.alt||"";btf.wrap(e,"a",{href:t,"data-fancybox":"gallery","data-caption":n,"data-thumb":t})}}),window.fancyboxRun||(Fancybox.bind("[data-fancybox]",{Hash:!1,Thumbs:{showOnStart:!1},Images:{Panzoom:{maxScale:4}},Carousel:{transition:"slide"},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}}}),window.fancyboxRun=!0))},setLoading:{add:e=>{const t='\n            <div class="loading-container">\n              <div class="loading-item">\n                <div></div><div></div><div></div><div></div><div></div>\n              </div>\n            </div>\n          ';e.insertAdjacentHTML("afterend",t)},remove:e=>{e.nextElementSibling.remove()}},updateAnchor:e=>{if(e!==window.location.hash){e||(e=location.pathname);const t=s.title;window.history.replaceState({url:location.href,title:t},t,e)}},getScrollPercent:(()=>{let e,t,n,o;return(i,a)=>{e&&a.clientHeight===e||(e=a.clientHeight,t=window.innerHeight,n=a.offsetTop,o=Math.max(e-t,document.documentElement.scrollHeight-t));const s=(i-n)/o;return Math.max(0,Math.min(100,Math.round(100*s)))}})(),addEventListenerPjax:(e,t,n,o=!1)=>{e.addEventListener(t,n,o),btf.addGlobalFn("pjaxSendOnce",()=>{e.removeEventListener(t,n,o)})},removeGlobalFnEvent:(e,t=window)=>{const n=t.globalFn||{},o=n[e];o&&(Object.keys(o).forEach(e=>o[e]()),delete n[e])},switchComments:(e=document,t)=>{const n=e.querySelector("#switch-btn");if(!n)return;let o=!1;const i=e.querySelector("#post-comment"),a=()=>{i.classList.toggle("move"),o||"function"!=typeof loadOtherComment||(o=!0,loadOtherComment(e,t))};btf.addEventListenerPjax(n,"click",a)}};window.btf={...window.btf,...r},document.addEventListener("DOMContentLoaded",()=>{let e,t,n=!1;const o=n=>{const o=e=>Array.from(e).reduce((e,t)=>e+t.offsetWidth,0);if(n){const n=o(document.querySelector("#blog-info > a").children),i=o(document.getElementById("menus").children);e=n+i,t=document.getElementById("nav")}const i=window.innerWidth<=768||e>t.offsetWidth-120;t.classList.toggle("hide-menu",i)},i=()=>{o(!0),t.classList.add("show")},r={open:()=>{btf.overflowPaddingR.add(),btf.animateIn(document.getElementById("menu-mask"),"to_show 0.5s"),document.getElementById("sidebar-menus").classList.add("open"),n=!0},close:()=>{btf.overflowPaddingR.remove(),btf.animateOut(document.getElementById("menu-mask"),"to_hide 0.5s"),document.getElementById("sidebar-menus").classList.remove("open"),n=!1}},l=()=>{const e=()=>{btf.scrollToDest(document.getElementById("content-inner").offsetTop,300)},t=document.getElementById("scroll-down");t&&btf.addEventListenerPjax(t,"click",e)},c=()=>{const e=a.highlight;if(!e)return;const{highlightCopy:t,highlightLang:n,highlightHeightLimit:o,highlightFullpage:i,highlightMacStyle:r,plugin:l}=e,c=s.isHighlightShrink,d=t||n||void 0!==c||i||r,m="highlight.js"===l?document.querySelectorAll("figure.highlight"):document.querySelectorAll('pre[class*="language-"]');if(!d&&!o||!m.length)return;const h="prismjs"===l,g=!0===c?"closed":"",u=void 0!==c?'<i class="fas fa-angle-down expand"></i>':"",f=t?'<div class="copy-notice"></div><i class="fas fa-paste copy-button"></i>':"",p='<div class="macStyle"><div class="mac-close"></div><div class="mac-minimize"></div><div class="mac-maximize"></div></div>',y=i?'<i class="fa-solid fa-up-right-and-down-left-from-center fullpage-button"></i>':"",b=(e,t)=>{void 0!==a.Snackbar?btf.snackbarShow(t):(e.textContent=t,e.style.opacity=1,setTimeout(()=>{e.style.opacity=0},800))},v=async(e,t)=>{try{await navigator.clipboard.writeText(e),b(t,a.copy.success)}catch(e){console.error("Failed to copy: ",e),b(t,a.copy.noSupport)}},w=(e,t)=>{const n=e.parentNode;n.classList.add("copy-true");const o=h?"pre code":"table .code pre",i=n.querySelector(o);i&&(v(i.innerText,t.previousElementSibling),n.classList.remove("copy-true"))},x=e=>e.classList.toggle("closed"),E=(e,t)=>{const n=e.closest("figure.highlight"),o=n.classList.toggle("code-fullpage");document.body.style.overflow=o?"hidden":"",t.classList.toggle("fa-down-left-and-up-right-to-center",o),t.classList.toggle("fa-up-right-and-down-left-from-center",!o)},L=e=>{const t=e.target.classList,n=e.currentTarget;t.contains("expand")?x(n):t.contains("copy-button")?w(n,e.target):t.contains("fullpage-button")&&E(n,e.target)},S=e=>e.currentTarget.classList.toggle("expand-done"),k=e=>{const t=new Map,n=()=>{let n=e;for(;n!==document.body&&null!=n;)"none"===window.getComputedStyle(n).display&&t.set(n,n.getAttribute("style")||""),n=n.parentNode;const o="visibility: hidden !important; display: block !important;";t.forEach((e,t)=>{t.setAttribute("style",e?e+";"+o:o)})},o=()=>{t.forEach((e,t)=>{""===e?t.removeAttribute("style"):t.setAttribute("style",e)})};n();const i=e.offsetHeight;return o(),i},C=(e,t)=>{const n=document.createDocumentFragment();if(d){const t=document.createElement("div");t.className=`highlight-tools ${g}`,t.innerHTML=p+u+e+f+y,btf.addEventListenerPjax(t,"click",L),n.appendChild(t)}if(o&&k(t)>o+30){const e=document.createElement("div");e.className="code-expand-btn",e.innerHTML='<i class="fas fa-angle-double-down"></i>',btf.addEventListenerPjax(e,"click",S),n.appendChild(e)}h?t.parentNode.insertBefore(n,t):t.insertBefore(n,t.firstChild)};m.forEach(e=>{let t="";h&&btf.wrap(e,"figure",{class:"highlight"}),n?(h?t=e.getAttribute("data-language")||"Code":(t=e.getAttribute("class").split(" ")[1],"plain"!==t&&void 0!==t||(t="Code")),C(`<div class="code-lang">${t}</div>`,e)):C("",e)})},d=()=>{a.isPhotoFigcaption&&document.querySelectorAll("#article-container img").forEach(e=>{const t=e.title||e.alt;if(!t)return;const n=document.createElement("div");n.className="img-alt text-center",n.textContent=t,e.insertAdjacentElement("afterend",n)})},m=()=>{btf.loadLightbox(document.querySelectorAll("#article-container img:not(.no-lightbox)"))},h=async e=>{try{const t=await fetch(e);return await t.json()}catch(e){return console.error("Failed to fetch URL:",e),[]}},g=(e,t,n)=>{const{isButton:o,limit:i,firstLimit:s,tabs:r}=n,l=t.length,c=Math.ceil((l-s)/i+1),d={gap:5,isConstantSize:!0,sizeRange:[150,600],useTransform:!0},m=new InfiniteGrid.JustifiedInfiniteGrid(e,d);let h=!1;const g=e=>e&&e.replace(/"/g,"&quot;")||"",u=e=>{const t=e.alt?`alt="${g(e.alt)}"`:"",n=e.title?`title="${g(e.title)}"`:"";return`<div class="item">\n              <img src="${e.url}" data-grid-maintained-target="true" ${t} ${n} />\n            </div>`},f=(e,n,o=!1)=>{const i=o?(e-1)*n:(e-2)*n+s;return t.slice(i,i+n).map(u)},p=e=>{const t=document.createElement("button");t.innerHTML=`${a.infinitegrid.buttonText}<i class="fa-solid fa-arrow-down"></i>`,t.addEventListener("click",()=>{t.remove(),btf.setLoading.add(e),y(m.getGroups().length+1,i)},{once:!0}),e.insertAdjacentElement("afterend",t)},y=(e,t,n)=>{m.append(f(e,t,n),e)},b=t=>{if(r){const t=e.parentNode;h&&(t.style.visibility="visible"),0===e.offsetHeight&&(t.style.visibility="hidden",h=!0)}const{updated:n,isResize:i,mounted:a}=t;if(n.length&&a.length&&!i){if(btf.loadLightbox(e.querySelectorAll("img:not(.medium-zoom-image)")),m.getGroups().length===c)return btf.setLoading.remove(e),void(!r&&m.off("renderComplete",b));o&&(btf.setLoading.remove(e),p(e))}},v=btf.debounce(e=>{const t=(+e.groupKey||0)+1;1===t?y(t,s,!0):y(t,i),t===c&&m.off("requestAppend",v)},300);btf.setLoading.add(e),m.on("renderComplete",b),o?y(1,s,!0):(m.on("requestAppend",v),m.renderItems()),btf.addGlobalFn("pjaxSendOnce",()=>m.destroy())},u=async(e,t=!1)=>{if(!e.length)return;const n=async()=>{for(const n of e){if(btf.isHidden(n)||n.classList.contains("loaded"))continue;const e={isButton:"true"===n.getAttribute("data-button"),limit:parseInt(n.getAttribute("data-limit"),10),firstLimit:parseInt(n.getAttribute("data-first"),10),tabs:t},o=n.firstElementChild,i=o.textContent;o.textContent="",n.classList.add("loaded");try{const t="url"===n.getAttribute("data-type")?await h(i):JSON.parse(i);g(o,t,e)}catch(e){console.error("Gallery data parsing failed:",e)}}};"function"==typeof InfiniteGrid?await n():(await btf.getScript(a.infinitegrid.js),await n())},f=e=>{const t=btf.getScrollPercent(e,document.body),n=document.getElementById("go-up");t<95?(n.classList.add("show-percent"),n.querySelector(".scroll-percent").textContent=t):n.classList.remove("show-percent")},p=()=>{const e=document.getElementById("rightside"),t=window.innerHeight+56;let n=0;const o=document.getElementById("page-header"),i="undefined"!=typeof chatBtn,s=a.percent.rightside,r=()=>document.body.scrollHeight<=t&&(e.classList.add("rightside-show"),!0);if(r())return;const l=e=>{const t=e>n;return n=e,t};let c="";const d=btf.throttle(()=>{const t=window.scrollY||document.documentElement.scrollTop,n=l(t);t>56?(""===c&&(o.classList.add("nav-fixed"),e.classList.add("rightside-show")),n?"down"!==c&&(o.classList.remove("nav-visible"),i&&window.chatBtn.hide(),c="down"):"up"!==c&&(o.classList.add("nav-visible"),i&&window.chatBtn.show(),c="up")):(c="",0===t&&o.classList.remove("nav-fixed","nav-visible"),e.classList.remove("rightside-show")),s&&f(t),r()},300);btf.addEventListenerPjax(window,"scroll",d,{passive:!0})},y=()=>{const e=s.isToc,t=a.isAnchor,n=document.getElementById("article-container");if(!n||!e&&!t)return;let o,i,r,l,c;if(e){const e=document.getElementById("card-toc");i=e.querySelector(".toc-content"),o=i.querySelectorAll(".toc-link"),l=e.querySelector(".toc-percentage"),c=i.classList.contains("is-expand");const t=t=>{const n=t.target.closest(".toc-link");n&&(t.preventDefault(),btf.scrollToDest(btf.getEleTop(document.getElementById(decodeURI(n.getAttribute("href")).replace("#",""))),300),window.innerWidth<900&&e.classList.remove("open"))};btf.addEventListenerPjax(i,"click",t),r=(e=>{const t=i.clientHeight,n=e.offsetTop,o=e.clientHeight,a=i.scrollTop,s=n-a,r=(t-o)/2;s!==r&&(i.scrollTop=a+(s-r))}),i.style.display="block"}const d=n.querySelectorAll("h1,h2,h3,h4,h5,h6");let m="";const h=n=>{if(0===n)return!1;let a="",s="";for(let e=0;e<d.length;e++){const t=d[e];if(!(n>btf.getEleTop(t)-80))break;{const n=t.id;a=n?"#"+encodeURI(n):"",s=e}}if(m!==s&&(t&&btf.updateAnchor(a),m=s,e&&(i.querySelectorAll(".active").forEach(e=>e.classList.remove("active")),a))){const e=o[s];if(e.classList.add("active"),setTimeout(()=>r(e),0),!c){let t=e.parentNode;for(;!t.matches(".toc");)t.matches("li")&&t.classList.add("active"),t=t.parentNode}}},g=btf.throttle(()=>{const t=window.scrollY||document.documentElement.scrollTop;e&&a.percent.toc&&(l.textContent=btf.getScrollPercent(t,n)),h(t)},100);btf.addEventListenerPjax(window,"scroll",g,{passive:!0})},b=e=>{const t=window.globalFn||{},n=t.themeChange||{};n&&Object.keys(n).forEach(t=>{const o=n[t];["disqus","disqusjs"].includes(t)?setTimeout(()=>o(e),300):o(e)})},v={readmode:()=>{const e=document.body,t=document.createElement("button"),n=()=>{e.classList.remove("read-mode"),t.remove(),t.removeEventListener("click",n)};e.classList.add("read-mode"),t.type="button",t.className="fas fa-sign-out-alt exit-readmode",t.addEventListener("click",n),e.appendChild(t)},darkmode:()=>{const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";"dark"===e?(btf.activateDarkMode(),void 0!==a.Snackbar&&btf.snackbarShow(a.Snackbar.day_to_night)):(btf.activateLightMode(),void 0!==a.Snackbar&&btf.snackbarShow(a.Snackbar.night_to_day)),btf.saveToLocal.set("theme",e,2),b(e)},"rightside-config":e=>{const t=e.firstElementChild;t.classList.contains("show")&&(t.classList.add("status"),setTimeout(()=>{t.classList.remove("status")},300)),t.classList.toggle("show")},"go-up":()=>{btf.scrollToDest(0,500)},"hide-aside-btn":()=>{const e=document.documentElement.classList,t=e.contains("hide-aside")?"show":"hide";btf.saveToLocal.set("aside-status",t,2),e.toggle("hide-aside")},"mobile-toc-button":(e,t)=>{const n=document.getElementById("card-toc");n.style.transition="transform 0.3s ease-in-out";const o=n.clientHeight,i=t.getBoundingClientRect(),a=window.innerHeight-i.bottom-30;o>a&&(n.style.transformOrigin=`right ${o-a-i.height/2}px`),n.classList.toggle("open"),n.addEventListener("transitionend",()=>{n.style.cssText=""},{once:!0})},"chat-btn":()=>{window.chatBtnFn()},translateLink:()=>{window.translateFn.translatePage()}};document.getElementById("rightside").addEventListener("click",e=>{const t=e.target.closest("[id]");t&&v[t.id]&&v[t.id](e.currentTarget,t)});const w=()=>{const e=e=>{const t=e.target.closest(".site-page.group");t&&t.classList.toggle("hide")},t=document.querySelector("#sidebar-menus .menus_items");t&&t.addEventListener("click",e)},x=()=>{const e=document.getElementById("toggle-menu");e&&btf.addEventListenerPjax(e,"click",()=>{r.open()})},E=()=>{const{limitCount:e,languages:t}=a.copyright,n=n=>{n.preventDefault();const o=window.getSelection(0).toString();let i=o;return o.length>e&&(i=`${o}\n\n\n${t.author}\n${t.link}${window.location.href}\n${t.source}\n${t.info}`),n.clipboardData?n.clipboardData.setData("text",i):window.clipboardData.setData("text",i)};document.body.addEventListener("copy",n)},L=()=>{const e=document.getElementById("runtimeshow");if(e){const t=e.getAttribute("data-publishDate");e.textContent=`${btf.diffDate(t)} ${a.runtime}`}},S=()=>{const e=document.getElementById("last-push-date");if(e){const t=e.getAttribute("data-lastPushDate");e.textContent=btf.diffDate(t,!0)}},k=()=>{const e=document.querySelectorAll("#article-container table");e.length&&e.forEach(e=>{e.closest(".highlight")||btf.wrap(e,"div",{class:"table-wrap"})})},C=()=>{const e=document.querySelectorAll("#article-container .hide-button");e.length&&e.forEach(e=>e.addEventListener("click",e=>{const t=e.currentTarget;t.classList.add("open"),u(t.nextElementSibling.querySelectorAll(".gallery-container"))},{once:!0}))},I=()=>{const e=document.querySelectorAll("#article-container .tabs");if(!e.length)return;const t=(e,t)=>{e.forEach((e,n)=>{e.classList.toggle("active",n===t)})},n=e=>{const n=e.target.closest("button");if(!n||n.classList.contains("active"))return;const o=[...e.currentTarget.children],i=[...e.currentTarget.nextElementSibling.children],a=o.indexOf(n);t(o,a),e.currentTarget.classList.remove("no-default"),t(i,a),u(i[a].querySelectorAll(".gallery-container"),!0)},o=e=>t=>{t.target.closest("button")&&btf.scrollToDest(btf.getEleTop(e),300)};e.forEach(e=>{btf.addEventListenerPjax(e.firstElementChild,"click",n),btf.addEventListenerPjax(e.lastElementChild,"click",o(e))})},T=()=>{const e=document.querySelector("#aside-cat-list.expandBtn");if(!e)return;const t=e=>{const t=e.target;"I"===t.nodeName&&(e.preventDefault(),t.parentNode.classList.toggle("expand"))};btf.addEventListenerPjax(e,"click",t,!0)},A=()=>{const e=document.getElementById("post-outdate-notice");if(!e)return;const{limitDay:t,messagePrev:n,messageNext:o,postUpdate:i}=JSON.parse(e.getAttribute("data")),a=btf.diffDate(i);a>=t&&(e.textContent=`${n} ${a} ${o}`,e.hidden=!1)},j=()=>{window.lazyLoadInstance=new LazyLoad({elements_selector:"img",threshold:0,data_src:"lazy-src"}),btf.addGlobalFn("pjaxComplete",()=>{window.lazyLoadInstance.update()},"lazyload")},z=e=>{e.forEach(e=>{e.textContent=btf.diffDate(e.getAttribute("datetime"),!0),e.style.display="inline"})},B=()=>{const e=document.getElementById("recent-posts");if(!e||!e.classList.contains("masonry"))return;const t=()=>{const e=new InfiniteGrid.MasonryInfiniteGrid(".recent-post-items",{gap:{horizontal:10,vertical:20},useTransform:!0,useResizeObserver:!0});e.renderItems(),btf.addGlobalFn("pjaxCompleteOnce",()=>{e.destroy()},"removeJustifiedIndexPostUI")};"function"==typeof InfiniteGrid?t():btf.getScript(`${a.infinitegrid.js}`).then(t)},q=()=>{window.addEventListener("resize",()=>{o(!1),n&&btf.isHidden(document.getElementById("toggle-menu"))&&r.close()});const e=document.getElementById("menu-mask");e&&e.addEventListener("click",()=>{r.close()}),w(),a.islazyloadPlugin&&j(),void 0!==a.copyright&&E(),a.autoDarkmode&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{void 0===btf.saveToLocal.get("theme")&&(e.matches?b("dark"):b("light"))})},D=()=>{c(),d(),u(document.querySelectorAll("#article-container .gallery-container")),m(),y(),k(),C(),I()},P=()=>{i(),B(),"post"===s.pageType?(A(),a.relativeDate.post&&z(document.querySelectorAll("#post-meta time"))):(a.relativeDate.homepage&&z(document.querySelectorAll("#recent-posts time")),a.runtime&&L(),S(),T()),"home"===s.pageType&&l(),p(),D(),"shuoshuo"!==s.pageType&&btf.switchComments(document),x()};btf.addGlobalFn("pjaxComplete",P,"refreshFn"),P(),q(),window.addEventListener("hexo-blog-decrypt",e=>{D(),window.translateFn.translateInitialization(),Object.values(window.globalFn.encrypt).forEach(e=>{e()})})})})(),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.expand=800,whenDOMReady();var pjax=new Pjax({elements:"a",selectors:["title","meta",".site-title",".layout"],cacheBust:!1});document.addEventListener("pjax:success",whenDOMReady);let loader=document.querySelector(".pjax-loader");document.addEventListener("pjax:send",function(){loader.style.width="70%";let e=document.querySelector("#pjax-container .page-content");e&&e.classList.add("page-out")}),document.addEventListener("pjax:complete",function(){loader.style.width="100%",setTimeout(()=>{loader.style.width="0%"},300);let e=document.querySelector("#pjax-container .page-content");e&&(e.classList.add("page-in"),e.offsetWidth,e.classList.remove("page-in"))}),document.addEventListener("pjax:error",function(e){console.error("PJAX Error:",e),loader.style.width="0%"}),document.addEventListener("pjax:send",function(){document.body.classList.add("pjax-loading")}),document.addEventListener("pjax:complete",function(){document.body.classList.remove("pjax-loading")});const galleryStyle=document.createElement("style");galleryStyle.textContent="\n.gallery-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0,0,0,0.95);\n    z-index: 2147483647;\n    cursor: zoom-out;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.gallery-image-container {\n    position: relative;\n    max-width: 90vw;\n    max-height: 90vh;\n    transition: transform 0.3s ease;\n}\n\n.gallery-image {\n    max-width: 100%;\n    max-height: 100vh;\n    object-fit: contain;\n    opacity: 0;\n    transition: opacity 0.3s;\n}\n\n.gallery-nav {\n    position: fixed;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 40px;\n    height: 40px;\n    background: #070c13;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24px;\n    z-index: 1;\n}\n\n.gallery-prev { left: 20px; }\n.gallery-next { right: 20px; }\n\n.gallery-counter {\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    color: white;\n    font-size: 14px;\n    background: rgba(0,0,0,0.5);\n    padding: 5px 15px;\n    border-radius: 20px;\n}\n\n.loading-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 40px;\n    height: 40px;\n    border: 4px solid #070c13;\n    border-radius: 50%;\n    border-top-color: white;\n    animation: spin 1s linear infinite;\n    transform: translate(-50%, -50%);\n}\n\n.error-message {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    color: #ff4444;\n    transform: translate(-50%, -50%);\n    white-space: nowrap;\n}\n\n@keyframes spin {\n    to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.zoom-controls {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: rgba(0,0,0,0.5);\n    padding: 10px;\n    border-radius: 8px;\n    display: flex;\n    gap: 10px;\n}\n\n.zoom-btn {\n    width: 40px;\n    height: 40px;\n    background: #070c13;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n}\n.gallery-close {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    width: 40px;\n    height: 40px;\n    background: #070c13;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24px;\n    z-index: 2147483647;\n}\n\n.gallery-close:hover {\n    background: #070c13;\n    transform: rotate(90deg);\n    transition: all 0.3s ease;\n}\n",document.head.appendChild(galleryStyle);class ImageViewer{constructor(){this.images=[],this.currentIndex=0,this.scale=1,this.init()}init(){this.loadImages()}loadImages(){const e=document.querySelector("#article-container");this.images=Array.from(e.querySelectorAll("img[data-src]")),this.images.forEach((e,t)=>{e.dataset.galleryIndex=t,e.style.cursor="zoom-in",e.addEventListener("click",e=>{e.stopPropagation(),this.show(t)})})}show(e){this.currentIndex=e,this.scale=1,this.createOverlay(),this.loadCurrentImage()}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="gallery-overlay",this.imageContainer=document.createElement("div"),this.imageContainer.className="gallery-image-container",this.imageEl=document.createElement("img"),this.imageEl.className="gallery-image",this.loader=document.createElement("div"),this.loader.className="loading-spinner",this.prevBtn=this.createButton("❮","gallery-prev"),this.nextBtn=this.createButton("❯","gallery-next"),this.counter=this.createCounter(),this.zoomControls=this.createZoomControls(),this.imageContainer.append(this.imageEl,this.loader),this.overlay.append(this.prevBtn,this.imageContainer,this.nextBtn,this.counter,this.zoomControls),document.body.appendChild(this.overlay),document.body.style.overflow="hidden",this.closeBtn=document.createElement("div"),this.closeBtn.className="gallery-close",this.closeBtn.textContent="×",this.closeBtn.onclick=(()=>this.close()),this.overlay.append(this.prevBtn,this.imageContainer,this.nextBtn,this.counter,this.zoomControls,this.closeBtn)}createButton(e,t){const n=document.createElement("div");return n.className=`gallery-nav ${t}`,n.textContent=e,n}createCounter(){const e=document.createElement("div");return e.className="gallery-counter",e}createZoomControls(){const e=document.createElement("div");e.className="zoom-controls";const t=document.createElement("div");t.className="zoom-btn",t.textContent="+",t.onclick=(()=>this.setScale(this.scale+.2));const n=document.createElement("div");n.className="zoom-btn",n.textContent="-",n.onclick=(()=>this.setScale(this.scale-.2));const o=document.createElement("div");return o.className="zoom-btn",o.textContent="↺",o.onclick=(()=>this.resetScale()),e.append(t,n,o),e}async loadCurrentImage(){try{this.showLoading(),await this.loadImage(this.images[this.currentIndex].dataset.src),this.hideLoading(),this.updateInterface()}catch(e){this.showError("图片加载失败")}}hideLoading(){this.loader.style.display="none"}loadImage(e){return new Promise((t,n)=>{this.imageEl.onload=(()=>{this.imageEl.style.opacity=1,this.hideLoading(),t()}),this.imageEl.onerror=(()=>n()),this.imageEl.src=e})}showLoading(){this.loader.style.display="block",this.imageEl.style.opacity=0}showError(e){const t=document.createElement("div");t.className="error-message",t.textContent=e,this.imageContainer.appendChild(t),this.loader.style.display="none"}updateInterface(){this.counter.textContent=`${this.currentIndex+1}/${this.images.length}`,this.prevBtn.style.display=this.currentIndex>0?"flex":"none",this.nextBtn.style.display=this.currentIndex<this.images.length-1?"flex":"none",this.bindEvents()}bindEvents(){this.prevBtn.onclick=(()=>this.navigate(-1)),this.nextBtn.onclick=(()=>this.navigate(1)),this.overlay.onclick=(e=>{e.target===this.overlay&&this.close()}),this.keyHandler=(e=>{switch(e.key){case"ArrowLeft":this.navigate(-1);break;case"ArrowRight":this.navigate(1);break;case"Escape":this.close();break;case"+":this.setScale(this.scale+.2);break;case"-":this.setScale(this.scale-.2);break;case"0":this.resetScale()}}),document.addEventListener("keydown",this.keyHandler),this.wheelHandler=(e=>{e.preventDefault();const t=-.1*Math.sign(e.deltaY);this.setScale(this.scale+t)}),this.overlay.addEventListener("wheel",this.wheelHandler);let e=0;this.overlay.addEventListener("touchstart",t=>{e=t.touches[0].clientX}),this.overlay.addEventListener("touchend",t=>{const n=t.changedTouches[0].clientX-e;Math.abs(n)>50&&this.navigate(n>0?-1:1)})}navigate(e){this.currentIndex=(this.currentIndex+e+this.images.length)%this.images.length,this.scale=1,this.imageContainer.style.transform="scale(1)",this.loadCurrentImage()}setScale(e){this.scale=Math.min(Math.max(e,.5),3),this.imageContainer.style.transform=`scale(${this.scale})`}resetScale(){this.scale=1,this.imageContainer.style.transform="scale(1)"}close(){document.body.removeChild(this.overlay),document.body.style.overflow="",document.removeEventListener("keydown",this.keyHandler)}}document.addEventListener("DOMContentLoaded",()=>{new ImageViewer});